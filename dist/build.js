!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VFolder=t()}(this,function(){"use strict";function e(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function t(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==r.join(""))return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(e){a[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},a)).join("")}catch(e){return!1}}function n(e,t,r,a){void 0===e&&(e={}),a=a.replace(/^\s*\/+/,"/");var o=t.node,c=t.branch,s=t.leaf,i=t.check,u=t.open,h=e[o]||"/",f=e[c]||[],d=e[s]||[],l=f.length>0||d.length>0;a||(a="/"===h?h:"/"+h),f=f.map(function(e,c){return"string"==typeof e&&(e={},e[o]=e),n(e,t,r+"."+c,a+"/"+e[o])}),d=d.map(function(e,t){return{name:e,type:"leaf",check:i,level:r+"."+t,path:a+"/"+e}});var p=l?"filled":"empty";return{name:h,type:"branch",level:r,path:a,node:{name:h,open:0==r||u,canOpen:l,check:i,level:r,path:a,type:"node",status:p},branches:f,leafs:d}}var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,c=t()?Object.assign:function(t,n){for(var c,s,i=arguments,u=e(t),h=1;h<arguments.length;h++){c=Object(i[h]);for(var f in c)a.call(c,f)&&(u[f]=c[f]);if(r){s=r(c);for(var d=0;d<s.length;d++)o.call(c,s[d])&&(u[s[d]]=c[s[d]])}}return u},s=function e(t){var n={};return t&&"object"==typeof t?(t instanceof Array&&(n=[]),Object.keys(t).forEach(function(r){"object"==typeof t[r]?n[r]=e(t[r]):n[r]=t[r]}),n):t},i=[].push,u={node:"name",branch:"dirs",leaf:"files",open:!1,check:-1},h=function(e,t){this.conf=c({},u,t);var r=e.path||e[this.conf.node]||"/",a=r.split("/").filter(function(e){return!!e}).slice(-1)[0]||e.name;e.name=a,this.dataStore=n(e,this.conf,"0",r)};h.prototype.replace=function(e){this.dataStore=e},h.prototype.findParentBranch=function(e){void 0===e&&(e="");var t=e.length,n=this.dataStore;if(t<=1)return null;for(var r=e.split(".").slice(1,-1),a=0;n&&(a=r.shift());)n=n.branches[a];return n},h.prototype.findCurrentBranch=function(e){void 0===e&&(e="");for(var t=e.split(".").slice(1),n=0,r=this.dataStore;r&&(n=t.shift());)r=r.branches[n];return r},h.prototype.checkBranchAscendents=function(e,t){if(e){var n=e.branches,r=e.leafs,a=e.node,o=e.level,c=0;switch(t){case 1:var s=!n.length||!n.some(function(e){return e.node.check<1}),i=!r.length||!r.some(function(e){return e.check<1});c=s&&i?1:0;break;case 0:c=0;break;case-1:var u=!n.length||!n.some(function(e){return e.node.check>-1}),h=!r.length||!r.some(function(e){return e.check>-1});c=u&&h?-1:0}a.check=c,this.checkBranchAscendents(this.findParentBranch(o),c)}},h.prototype.checkBranchDescendents=function(e,t){var n=this;e.node.check=t,t&&(e.leafs.forEach(function(e){return e.check=t}),e.branches.forEach(function(e){e.node.check=t,n.checkBranchDescendents(e,t)}))},h.prototype.checkNode=function(e){var t=this.findCurrentBranch(e.level),n=t.node.check,r=n<1?1:-1;this.checkBranchDescendents(t,r),this.checkBranchAscendents(this.findParentBranch(t.level),r)},h.prototype.checkLeaf=function(e){var t=this.findParentBranch(e.level),n=-1*e.check;e.check=n,this.checkBranchAscendents(t,n)},h.prototype.merge=function(e,t){void 0===e&&(e={}),void 0===t&&(t={level:"0",path:""});var r=t.level,a=t.path,o=t.check,c=r.split(".").slice(1),i=n(e,this.conf,r,a);if(i.node.open=!0,i.node.check=o,i.node.status="done",0===c.length)this.replace(i);else{for(var u=s(this.dataStore),h=u,f=c.pop(),d=0;d=c.shift();)h=h.branches[d];h.branches.splice(f,1,i),h.node.canOpen=!0,this.replace(u)}this.checkBranchDescendents(i,o)},h.prototype.commit=function(e,t){var n=this;return new Promise(function(r,a){var o="node"===t.type;return"change"===e?(n[o?"checkNode":"checkLeaf"](t),r(n.getPathResult())):void("unfold"===e&&o&&(t.open=!t.open,t.canOpen||"done"===t.status?a():(t.status="loading",r())))})},h.prototype.getPathResult=function(e){var t=this;e=e||this.dataStore;var n=[],r=e.node,a=e.branches,o=e.leafs;e.path;return r.check>0?n.push(e.path):(o.forEach(function(e){var t=e.check,r=e.path;t>0&&n.push(r)}),a.forEach(function(e){i.apply(n,t.getPathResult(e))})),n},h.prototype.raw=function(){return n.raw(this.dataStore,this.conf)};var f={methods:{notify:function(e){this.___vemit(e,this.data)},listen:function(e,t){this.___von(e,function(e){t(e)})},distroy:function(){this.___voff()}}},d=["fa-square-o","fa-minus-square-o","fa-check-square-o"],l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{key:e.data.level,staticClass:"v-node"},[n("i",{staticClass:"fa",class:e.folderClass,on:{click:function(t){e.notify("unfold")}}}),e._v(" "),n("span",{on:{click:function(t){e.notify("change")}}},[n("i",{staticClass:"fa",class:e.checkboxClass}),e._v(" "+e._s(e.data.name))])])},staticRenderFns:[],name:"v-node",mixins:[f],props:{data:{type:Object,required:!0},uid:{type:[String,Number],required:!0}},computed:{folderClass:function(){var e=this.data,t="loading"===e.status,n=e.canOpen&&e.open,r=!e.canOpen&&"done"===e.status;return{"fa-spinner cursor-progress":t,"fa-folder-open-o":!t&&n,"fa-folder-o":!t&&!n,"cursor-no-ops":r}},checkboxClass:function(){return d[this.data.check+1]}}},p=["fa-square-o","fa-minus-square-o","fa-check-square-o"],v={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{key:e.data.level,staticClass:"v-leaf",on:{click:function(t){e.notify("change")}}},[n("i",{staticClass:"fa",class:e.className}),e._v(" "+e._s(e.data.name))])},staticRenderFns:[],name:"v-leaf",mixins:[f],props:{data:{type:Object,required:!0},uid:{type:[String,Number],required:!0}},computed:{className:function(){return p[this.data.check+1]}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{key:e.node.level,staticClass:"v-branch"},[n("ul",{staticClass:"v-branch-body"},[n("v-node",{attrs:{data:e.node,uid:e.uid}}),e._l(e.branches,function(t){return n("v-branch",{directives:[{name:"show",rawName:"v-show",value:e.node.open,expression:"node.open"}],attrs:{data:t,uid:e.uid}})}),e._l(e.leafs,function(t){return n("v-leaf",{directives:[{name:"show",rawName:"v-show",value:e.node.open,expression:"node.open"}],attrs:{data:t,uid:e.uid}})})],2)])},staticRenderFns:[],name:"v-branch",mixins:[f],props:{data:{type:Object,required:!0},uid:{type:[String,Number],required:!0}},components:{"v-node":l,"v-leaf":v},computed:{branches:function(){return this.data.branches},leafs:function(){return this.data.leafs},node:function(){return this.data.node}}},b=0,y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"v-branch-body"},[n("v-node",{attrs:{data:e.node,uid:e.uid}}),e._l(e.branches,function(t){return n("v-branch",{directives:[{name:"show",rawName:"v-show",value:e.node.open,expression:"node.open"}],attrs:{data:t,uid:e.uid}})}),e._l(e.leafs,function(t){return n("v-leaf",{directives:[{name:"show",rawName:"v-show",value:e.node.open,expression:"node.open"}],attrs:{data:t,uid:e.uid}})})],2)},staticRenderFns:[],name:"v-folder",mixins:[f],props:{data:Object,ajax:Object,conf:Object},components:{"v-node":l,"v-leaf":v,"v-branch":m},watch:{data:function(e,t){var n=this.conf&&this.conf.node||"name";e[n]!==t[n]&&(this.store=new h(e,this.conf))}},data:function(){return{uid:b++,store:new h(this.data,this.conf)}},computed:{root:function(){return this.store.dataStore},branches:function(){return this.root.branches},leafs:function(){return this.root.leafs},node:function(){return this.root.node}},methods:{resTransform:function(e,t){var n=this.conf||{},r=n.branch||"dirs",a=(n.leaf||"files",n.node||"name");return e[a]=t.name,e[r]=e[r].map(function(e){return t={},t[a]=e,t;var t}),e},getReqConf:function(e){var t=this.ajax||{},n=(t.url,t.method),r=t.data,a=t.params,o=t.pathAs,c=t.headers;return n||"GET"===n.toUpperCase()?(t.params=a||{},t.params[o]=e.path):(t.data=r||{},t.data[o]=e.path),t.method=n||"GET",t.headers=c||{},t},request:function(e){var t=this;if(!this.ajax)return Promise.reject("ajax:false");var n=this.ajax.process||function(e){return e};return this.$http(this.getReqConf(e)).then(function(r){var a=n(r.data);return t.resTransform(a,e)})}},created:function(){var e=this;this.listen("change",function(t){e.store.commit("change",t).then(function(t){return e.$emit("change",t)})}),this.listen("unfold",function(t){return t.open&&t.canOpen?void(t.open=!t.open):void e.store.commit("unfold",t).then(function(){e.request(t).then(function(n){if(!n)throw"empty";e.store.merge(n,t)}).catch(function(e){t.status="empty",window.console&&console.error(e)})}).catch(function(e){return t.status="done"})})},destroyed:function(){this.distroy()}},k=function(e){var t=new e,n=e.prototype;n.___von=function(e,n){var r=this.uid,a=function(e){r===e.uid&&n&&n(e.data)};t.$on("#"+r+"@"+e,a)},n.___vemit=function(e,n){var r=this.uid;t.$emit("#"+r+"@"+e,{data:n,uid:r})},n.___voff=function(e,n){var r=this.uid;if(e)t.$off("#"+r+"@"+e,n);else{r="#"+r+"@";var a=(r.length,Object.keys(t._events)),o=a.filter(function(e){return 0===e.indexOf(r)});o.forEach(function(e){t.$off(e,n)})}}};return y.install=function(e){var t=e.version.split("."),n=t[0],r=t[1],a=t[2];if(n>2||2===n&&(r>1||1===r&&a>=5))throw"You should at least get Vue.js@2.1.5.";k(e),e.component(y.name,y)},y});
//# sourceMappingURL=build.js.map
